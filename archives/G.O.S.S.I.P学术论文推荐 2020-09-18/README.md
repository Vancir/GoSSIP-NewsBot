 智能合约的安全研究也是比较热门的方向，我们组在SANER 2020上就有两篇论文被录用，一篇是关于合约漏洞修复，一篇是关于fuzz合约来生成exploit。今天给大家推荐的来自软工顶会ASE的论文中的 SOLAR也是为了检测以太坊智能合约的漏洞并生成相应的exploit。 

    
 

  ![]() 

    
 

  其针对的主要是重入漏洞这类包含多个合约之间交互的问题，现有工具或是过度近似程序执行路径导致过多误报，又或是过度精确的模拟导致难以分析复杂合约。为了解决这一问题，作者引入了查询语言以及基于摘要的符号评估技术，以减少了exploit生成过程中需要进行符号评估的指令数目。 

    
 

  如图1所示，安全分析人员进行一次重入漏洞利用时，首先需要制定一个查询来描述重入的语义特征，然后来生成攻击程序，验证漏洞的存在。但是攻击的条件大多依赖于合约的状态，需要对合约API调用序列以及CFG执行路径进行探索，搜索空间相当大。 

    
 

  ![]() 

    
 

  为了精简搜索空间，作者首先用自己设计的中间语言（如图3）对智能合约进行转换。其中间语言包含了标准的EVM字节码操作和智能合约特定的操作，还扩展了符号变量和符号表达式。借助中间语言，将图4（a）中标准的合约代码转换为（b）中的符号评估形式。 

    
 

  ![]() 

    
 

  ![]() 

    
 

  ![]() 

    
 

  接着，作者设计了一套查询语言，如图5所示。在这种查询语言下，能将漏洞进行抽象，例如重入漏洞会被表示成如下形式的查询语句： 

    
 

  ![]() 

    
 

  有了漏洞查询语句，下面可以进行漏洞利用程序的合成。作者将图4（b）中与给定查询中相关操作的信息提取出来，得到图4（c）中的摘要，接着根据摘要进行解释得到图4（d）的结果。在实现上，SOLAR借助Rosette使用断言和符号值来表达有关程序行为的查询，然后使用现成的SMT求解器对其进行求解。为了提高效率，还将每一句查询拆解为子查询从而实现并行。 

    
 

  作为评估，作者对25,983个有源码的智能合约进行了测试，并且与基于符号执行的Mythril、Teether以及基于fuzzing的ContractFuzzer进行对比。结果显示，SOLAR的误报率、漏报率以及效率上都有着较大优势，且基于摘要的符号评估确实大大提升了速度。 

    
 

  ![]() 

    
 

  ![]() 

    
 

  ![]() 

    
 

  ![]() 

    
 

  原文链接： 

  https://homes.cs.washington.edu/~emina/doc/solar.ase20.pdf 

    
 

    
 

    
 

    
 

